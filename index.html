```html
<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="utf-8">
<title>Index</title>

<style>
body{
  background:#000;
  color:#d0d0d0;
  font-family:monospace;
  margin:0;
  padding:40px
}
h1{color:#c0c0c0;font-weight:600}
ul{margin-bottom:30px;padding-left:20px}
li{color:#b8b8b8}
a{color:#b8b8b8;text-decoration:none}
a:hover{color:#e0e0e0;text-decoration:underline}

#viewer-wrapper{
  width:100%;
  display:flex;
  justify-content:center;
  margin-top:60px
}
#viewer{
  max-width:900px;
  width:100%;
  line-height:1.6;
  text-align:left
}
#viewer h1,#viewer h2,#viewer h3{color:#d8d8d8}
#viewer p{margin:1em 0}
#viewer ul{margin-left:20px}

.math.inline,mjx-inline{
  color:#c0c0c0 !important;
  text-shadow:0 0 4px rgba(192,192,192,0.35),
              0 0 10px rgba(255,255,255,0.25)
}
.math.block,mjx-container[jax="CHTML"][display="true"]{
  color:#d4af37 !important;
  text-shadow:0 0 6px rgba(212,175,55,0.4),
              0 0 14px rgba(255,215,0,0.3)
}

/* Bokläge */
body.book #file-list,
body.book h1:first-of-type,
body.book h1:nth-of-type(2),
body.book ul:nth-of-type(2){
  display:none;
}
body.book #viewer{
  max-width:1100px;
  margin:auto;
}
</style>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<script>
window.MathJax={
  tex:{inlineMath:[['$','$']],displayMath:[['$$','$$']]},
  options:{
    renderActions:{
      addRP9Classes:[200,function(doc){
        doc.math.forEach(m=>{
          const n=m.typesetRoot;
          n.classList.add("math",m.display?"block":"inline");
        });
      },""]
    }
  }
};
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
</head>

<body>

<h1>Index</h1>

<button id="toggle-recursive">Rekursiv: OFF</button>
<button id="toggle-book">Bokläge: OFF</button>

<input id="search" type="text" placeholder="Sök…" style="width:100%;margin-bottom:10px">

<ul id="file-list"></ul>

<h1>Filtyper som renderas</h1>
<ul>
<li>.html</li><li>.md</li><li>.markdown</li><li>.txt</li>
<li>.pdf</li><li>.png</li><li>.jpg</li><li>.jpeg</li>
<li>.gif</li><li>.svg</li><li>.zip</li>
<li>.csv</li><li>.json</li><li>.xml</li>
</ul>

<div id="viewer-wrapper">
  <div>
    <div id="toc"></div>
    <div id="viewer"></div>
  </div>
</div>

<script>
const owner="AntonWallin999";
const repo="3";
const branch="main";

const allowedExtensions=[
  ".html",".md",".markdown",".txt",".pdf",
  ".png",".jpg",".jpeg",".gif",".svg",
  ".zip",".csv",".json",".xml"
];

/* RATE LIMIT */
let apiCalls=0;
const API_LIMIT=55;
function safeFetch(url){
  if(apiCalls>=API_LIMIT){
    console.warn("GitHub rate-limit nära – avbryter");
    return Promise.reject("Rate limit");
  }
  apiCalls++;
  return fetch(url);
}

/* REKURSIV TOGGLE */
let recursiveMode=false;
document.getElementById("toggle-recursive").onclick=function(){
  recursiveMode=!recursiveMode;
  this.textContent="Rekursiv: "+(recursiveMode?"ON":"OFF");
  fileList.innerHTML="";
  recursiveMode?listRecursive(""):listRootOnly();
};

/* BOKLÄGE */
let bookMode=false;
document.getElementById("toggle-book").onclick=function(){
  bookMode=!bookMode;
  document.body.classList.toggle("book",bookMode);
  this.textContent="Bokläge: "+(bookMode?"ON":"OFF");
};

/* SÖK */
document.getElementById("search").addEventListener("input",function(){
  const q=this.value.toLowerCase();
  document.querySelectorAll("#file-list li").forEach(li=>{
    li.style.display=li.textContent.toLowerCase().includes(q)?"":"none";
  });
});

/* LISTNING */
const fileList=document.getElementById("file-list");

function listRootOnly(){
  safeFetch(`https://api.github.com/repos/${owner}/${repo}/contents?ref=${branch}`)
  .then(r=>r.json())
  .then(renderFiles);
}

function listRecursive(path){
  safeFetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}?ref=${branch}`)
  .then(r=>r.json())
  .then(items=>{
    items.forEach(item=>{
      if(item.type==="dir") listRecursive(item.path);
      else renderFiles([item]);
    });
  });
}

function renderFiles(files){
  files.forEach(file=>{
    if(file.type!=="file") return;
    if(!allowedExtensions.some(ext=>file.name.toLowerCase().endsWith(ext))) return;

    const li=document.createElement("li");
    const a=document.createElement("a");
    a.textContent=file.path||file.name;

    if(file.name.match(/\.(md|markdown)$/i)){
      a.href="#";
      a.onclick=function(){
        fetch(file.path||file.name)
        .then(r=>r.text())
        .then(t=>{
          viewer.innerHTML=marked.parse(t);
          buildTOC();
          MathJax.typesetPromise();
        });
        return false;
      };
    }else{
      a.href=file.path||file.name;
      a.target="_blank";
    }

    li.appendChild(a);
    fileList.appendChild(li);
  });
}

/* TOC */
function buildTOC(){
  const toc=document.getElementById("toc");
  toc.innerHTML="<strong>Innehåll</strong>";
  const ul=document.createElement("ul");

  document.querySelectorAll("#viewer h1,#viewer h2,#viewer h3").forEach((h,i)=>{
    const id="toc_"+i;
    h.id=id;
    const li=document.createElement("li");
    li.style.marginLeft=h.tagName==="H2"?"15px":h.tagName==="H3"?"30px":"0";
    const a=document.createElement("a");
    a.href="#"+id;
    a.textContent=h.textContent;
    li.appendChild(a);
    ul.appendChild(li);
  });

  toc.appendChild(ul);
}

/* INIT */
listRootOnly();
</script>

</body>
</html>
```
